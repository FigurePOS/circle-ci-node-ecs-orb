description: >
  Typical usecase for:
  - validation and production plan on every push
  - deploy to dev on push to master
  - deploy to prod after approval

usage:
  version: 2.1
  orbs:
    <orb-name>: figure/terraform@1.0.0
  workflows:
    validate_and_deploy:
      name: Terraform Validation and Deploy
      jobs:
        - <orb-name>/plan:
            name: plan_dev
            parameters:
              account_id: "880892332156"
              env: development
        - <orb-name>/plan:
            name: plan_prod
            parameters:
              account_id: "682919404744"
              env: production
        - <orb-name>/validate:
            name: validate
            parameters:
              account_id: "880892332156"
            requires:
              - plan_dev
        - <orb-name>/deploy:
            name: deploy_dev
            parameters:
              account_id: "880892332156"
              env: development
            requires:
              - plan_dev
            filters:
              branches:
                only: master
        - approve_deploy_prod:
            requires:
              - plan_prod
            type: approval
            filters:
              branches:
                only: master
        - <orb-name>/deploy:
            requires:
              - approve_deploy_prod
            parameters:
              account_id: "682919404744"
              env: production
